# K210car

https://wiki.01studio.cc/docs/canmv_k210/machine_vision/kpu

å› æ­¤æˆ‘ä»¬åœ¨ç¼–ç¨‹ä½¿ç”¨GPIOçš„æ—¶å€™éœ€è¦æ³¨å†Œä¸€ä¸‹ç¡¬ä»¶IOå’ŒK210å†…éƒ¨IOçš„å¯¹åº”å…³ç³»ã€‚æ³¨å†Œæ–¹å¼ä½¿ç”¨fpioa_managerï¼šç®€ç§°fmï¼Œè¯¥æ¨¡å—ç”¨äºæ³¨å†ŒèŠ¯ç‰‡å†…éƒ¨åŠŸèƒ½å’Œå¼•è„šï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†å†…éƒ¨åŠŸèƒ½å’Œå¼•è„šã€‚

**é¡¹ç›®æè¿°ï¼š**æœ¬é¡¹ç›®åŸºäºé£æ€å¡å°”Kå‹è½¦æ¨¡ï¼Œæ­è½½K210å¼€å‘æ¿ï¼Œæ„å»ºäº†ä¸€ä¸ªåŸå¸‚åƒåœ¾æ™ºèƒ½å·¡æ£€ç³»ç»Ÿã€‚ç³»ç»Ÿé€šè¿‡æ‘„åƒå¤´é‡‡é›†å›¾åƒï¼Œä½¿ç”¨YOLOç®—æ³•è¿›è¡Œåƒåœ¾è¯†åˆ«ï¼Œç»“åˆGPSæ¨¡å—è·å–ä½ç½®ä¿¡æ¯ï¼Œå¹¶å°†è¯†åˆ«ç»“æœä¸ä½ç½®æ•°æ®å­˜å‚¨åˆ°SDå¡ä¸­ï¼Œå½¢æˆå®Œæ•´çš„å·¡æ£€è®°å½•ã€‚

**æŠ€æœ¯æ ˆï¼šK210ã€RT-Threadã€SD/FATFS/DMA/Semã€GPS/UART(circular buffer)**

- ç§»æ¤RT-Threadå®æ—¶æ“ä½œç³»ç»Ÿåˆ°K210ä¸Š
- åŸºäº DMA+ä¿¡å·é‡å®ç° SD/FATFS **é˜»å¡**å¼é©±åŠ¨ï¼Œé€šè¿‡SDIO+DMA+FATFSå¯¹å›¾ç‰‡çš„å†™å…¥ï¼›
- GPSå’Œä¸²å£UARTçš„DMAå¾ªç¯æ¥å—FIFOç¯å½¢ç¼“å†²åŒºmu_blockså¯¹M9Nçš„æ•°æ®è§£æ**ï¼›**



MicroPython æ˜¯ä¸“ä¸º **å¾®æ§åˆ¶å™¨** å’ŒåµŒå…¥å¼è®¾å¤‡è®¾è®¡çš„ Python å®ç°ï¼Œå®ƒå’Œæ ‡å‡† Pythonï¼ˆé€šå¸¸æŒ‡ CPythonï¼‰åœ¨è¯­æ³•ä¸Šéå¸¸ç›¸è¿‘ï¼Œä½†åœ¨åŠŸèƒ½å’Œèµ„æºæ”¯æŒä¸Šæœ‰ä¸€äº›é‡è¦åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š

------

## ğŸ§  ä¸€å¥è¯æ€»ç»“ï¼š

> **MicroPython æ˜¯ä¸ºâ€œèµ„æºå—é™è®¾å¤‡â€ç²¾ç®€è¿‡çš„ Pythonï¼ŒåŠŸèƒ½è½»é‡ã€ç¡¬ä»¶å‹å¥½ï¼Œä½†ä¸å®Œå…¨ç­‰åŒäºæ ‡å‡† Pythonã€‚**

------

## ğŸ“Š MicroPython vs Pythonï¼ˆCPythonï¼‰å¯¹æ¯”è¡¨

| ç‰¹æ€§               | MicroPython                                                  | Pythonï¼ˆCPythonï¼‰                           |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------- |
| **è¿è¡Œå¹³å°**       | å¾®æ§åˆ¶å™¨ï¼ˆå¦‚ ESP32ã€STM32ã€RP2040ï¼‰                          | PCã€æœåŠ¡å™¨ã€æ ‘è“æ´¾ç­‰                        |
| **æ ‡å‡†åº“æ”¯æŒ**     | ç²¾ç®€ç‰ˆï¼ˆä¸å« `threading`, `multiprocessing`, `socketserver` ç­‰ï¼‰ | å…¨éƒ¨æ”¯æŒ                                    |
| **æ‰§è¡Œé€Ÿåº¦**       | è¾ƒæ…¢ï¼ˆè§£é‡Šæ‰§è¡Œï¼Œèµ„æºæœ‰é™ï¼‰                                   | æ›´å¿«ï¼ˆå¯ç”¨ JITã€PyPyã€C æ‰©å±•ï¼‰              |
| **å†…å­˜å ç”¨**       | éå¸¸å°ï¼ˆå‡ å KBï¼‰                                            | å ç”¨è¾ƒå¤§ï¼ˆå‡ å MBï¼‰                         |
| **å¤–è®¾æ§åˆ¶**       | å¼ºï¼ˆå†…ç½® `machine`, `uos`, `network` æ¨¡å—æ§åˆ¶ç¡¬ä»¶ï¼‰          | å¼±ï¼ˆéœ€é€šè¿‡å¤–éƒ¨åº“ï¼Œå¦‚ `pyserial`ï¼‰           |
| **å¼€å‘æ–¹å¼**       | é€šå¸¸åœ¨ä¸²å£ã€REPLã€çƒ§å½•å™¨ä¸­è¿è¡Œ                               | é€šå¸¸åœ¨ PC ä¸Š IDE æˆ–å‘½ä»¤è¡Œè¿è¡Œ               |
| **åŒ…ç®¡ç†**         | æ²¡æœ‰ pipï¼Œéœ€æ‰‹åŠ¨æ‹·è´ `.py` æ–‡ä»¶æˆ–ä½¿ç”¨ `mpremote`/`pyboard.py` | ä½¿ç”¨ `pip` ç®¡ç† PyPI åŒ…                     |
| **C API æ‰©å±•æ”¯æŒ** | å¯é€šè¿‡æ¨¡å—æ‰©å±•ï¼Œä½†æ›´å¤æ‚                                     | å®Œæ•´æ”¯æŒ C/C++ æ‰©å±•                         |
| **ä¸»è¦ç”¨é€”**       | æ§åˆ¶æ¿è½½ä¼ æ„Ÿå™¨ã€ç”µæœºã€é€šä¿¡æ¨¡å—ç­‰åµŒå…¥å¼ä»»åŠ¡                   | Webå¼€å‘ã€æ•°æ®åˆ†æã€è‡ªåŠ¨åŒ–è„šæœ¬ã€AIç­‰é€šç”¨ç¼–ç¨‹ |





K210è‡ªå¸¦_threadï¼ˆmicropythonï¼‰ ï¼Œè¿˜æœ‰å¿…è¦ç§»æ¤RTTæ“ä½œç³»ç»Ÿå—ï¼Œ



###### ChatGPT said:

è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»£è¡¨æ€§çš„é—®é¢˜ï¼Œæ¶‰åŠ **åµŒå…¥å¼ç³»ç»Ÿä¸­ MicroPython vs RTOSï¼ˆå¦‚ RT-Threadï¼‰** çš„å–èˆã€‚ä¸‹é¢æˆ‘ä»æ¶æ„ã€åŠŸèƒ½ã€æ€§èƒ½ã€å¼€å‘å¤æ‚åº¦ç­‰æ–¹é¢ç³»ç»Ÿåœ°å¸®ä½ åˆ†æï¼š

------

## ğŸ§  ä¸€å¥è¯æ€»ç»“ï¼š

> **å¦‚æœä½ ä»…éœ€è½»é‡ä»»åŠ¡è°ƒåº¦å’Œæ§åˆ¶é€»è¾‘ã€æ€§èƒ½è¦æ±‚ä¸æç«¯ï¼Œé‚£ä¹ˆ K210 çš„ MicroPython + `_thread` æ¨¡å—å·²ç»è¶³å¤Ÿã€‚**
>
> ä½†å¦‚æœä½ éœ€è¦ï¼š

- æ›´å¼ºçš„å®æ—¶æ€§ä¿éšœ
- å¤šçº¿ç¨‹è°ƒåº¦æ§åˆ¶ï¼ˆä¼˜å…ˆçº§ã€æŠ¢å ç­‰ï¼‰
- ä¸­æ–­ç®¡ç†ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å®šæ—¶å™¨ã€äº’æ–¥é”
- ä¸°å¯Œçš„ç»„ä»¶ç”Ÿæ€ï¼ˆå¦‚ GUIã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæ ˆï¼‰

> **é‚£å°±æœ‰å¿…è¦ç§»æ¤ RT-Threadï¼Œå¹¶åœ¨å…¶ä¸Šè¿è¡Œè£¸æœºåº”ç”¨æˆ– MicroPythonï¼ˆåµŒå…¥å¼ï¼‰ã€‚**

------

## ğŸ” ä¸€æ­¥æ­¥åˆ†æï¼š

### âœ… K210 + MicroPython è‡ªå¸¦ `_thread` æ¨¡å—èƒ½åšä»€ä¹ˆï¼Ÿ

K210 ä¸Šçš„ MicroPython ï¼ˆå¦‚ [MaixPy](https://github.com/sipeed/MaixPy)ï¼‰æä¾› `_thread`ï¼Œåº•å±‚é€šå¸¸åŸºäº freertos-lite æˆ–ç®€åŒ–çº¿ç¨‹è°ƒåº¦å™¨ï¼š

ä¼˜ç‚¹ï¼š

- æ”¯æŒå¤šçº¿ç¨‹ï¼ˆè™½ç„¶æ˜¯åä½œå¼æˆ–ä¼ªæŠ¢å å¼ï¼‰
- å¯ç”¨äºå¹¶è¡Œå¤„ç†å›¾åƒã€ä¸²å£ã€AIæ¨ç†ã€æ˜¾ç¤º
- ç®€å•æ˜“ç”¨ï¼Œå†™æ³•ç±»ä¼¼ CPythonï¼š

```
pythonCopy codeimport _thread

def task():
    while True:
        print("running task")

_thread.start_new_thread(task, ())
```

ç¼ºç‚¹ï¼š

- æ²¡æœ‰çº¿ç¨‹ä¼˜å…ˆçº§ã€ä¿¡å·é‡ã€äº‹ä»¶ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æœºåˆ¶
- å®æ—¶æ€§ä¸å¼º
- çº¿ç¨‹é—´ç«äº‰èµ„æºå¾ˆå®¹æ˜“å‡ºé”™ï¼ˆæ— è°ƒåº¦æ§åˆ¶ï¼‰
- æŠ¢å å¼è°ƒåº¦å‡ ä¹ä¸å¯æ§

------

### âœ… ç§»æ¤ RT-Thread çš„ä¼˜ç‚¹

å¦‚æœä½ æŠŠ RT-Thread ç§»æ¤åˆ° K210ï¼ˆæˆ–è€…ä½¿ç”¨ RT-Thread Studio + K210 SDKï¼‰ï¼Œä½ å¯ä»¥è·å¾—ï¼š

| ç‰¹æ€§               | æè¿°                                                         |
| ------------------ | ------------------------------------------------------------ |
| å®æ—¶æ€§å¼º           | æ”¯æŒæŠ¢å å¼å¤šä»»åŠ¡è°ƒåº¦ï¼Œé€‚åˆä¸­æ–­å¯†é›†å‹ã€å‘¨æœŸä»»åŠ¡               |
| å¤šçº¿ç¨‹æœºåˆ¶å®Œæ•´     | çº¿ç¨‹ä¼˜å…ˆçº§ã€æŠ¢å ã€ä¿¡å·é‡ã€äº’æ–¥é”ã€äº‹ä»¶ã€æ¶ˆæ¯é˜Ÿåˆ—             |
| æ›´ç¨³å®šçš„å¤šæ ¸æ”¯æŒ   | K210 æ˜¯åŒæ ¸ RISC-Vï¼ŒRTT å¯æ›´å¥½åˆ©ç”¨                           |
| å®šæ—¶å™¨ã€è½¯ä»¶å®šæ—¶å™¨ | ç²¾ç»†æ§åˆ¶ä»»åŠ¡å‘¨æœŸ                                             |
| è½¯ä»¶ç»„ä»¶ä¸°å¯Œ       | GUIï¼ˆLVGLï¼‰ã€AT ç½‘ç»œæ ˆã€æ–‡ä»¶ç³»ç»Ÿã€Sensor æ¡†æ¶                |
| å¯ç§»æ¤ MicroPython | RT-Thread æä¾›å®˜æ–¹ MicroPython ç§»æ¤åŒ…ï¼ˆrt-thread-micropythonï¼‰ |



------

### â“ ä»€ä¹ˆåœºæ™¯â€œå¿…é¡»â€ç”¨ RT-Threadï¼š

- å¤šä»»åŠ¡éœ€è¦ç»†ç²’åº¦è°ƒåº¦ï¼ˆå›¾åƒå¤„ç† + AI + é€šä¿¡ï¼‰
- è¦ç”¨ä¸­æ–­é…åˆå®šæ—¶å™¨ç²¾å‡†æ§åˆ¶é‡‡æ ·/é©±åŠ¨
- æœ‰å¤šä¸ªç‹¬ç«‹ç»„ä»¶ï¼ˆæ˜¾ç¤ºã€ä¼ æ„Ÿå™¨ã€AIï¼‰éœ€å¯é ååŒ
- éœ€è¦ GUI æˆ–æ— çº¿é€šä¿¡ç­‰ç³»ç»Ÿçº§æœåŠ¡ï¼ˆWLANã€BLEã€FSï¼‰
- é¡¹ç›®å¯¹å¯é æ€§/ç»´æŠ¤æ€§/æ‰©å±•æ€§æœ‰é«˜è¦æ±‚

------

### âŒ ä»€ä¹ˆæ—¶å€™ **ä¸å»ºè®®** ç§»æ¤ RT-Threadï¼š

- é¡¹ç›®ä½“é‡å°ï¼Œæ§åˆ¶é€»è¾‘ç®€å•
- ç”¨ MicroPython æ§åˆ¶ IOã€æ‰§è¡Œæ¨¡å‹æ¨ç†ã€æ˜¾ç¤ºå›¾åƒè¶³å¤Ÿ
- ä½ æ›´åå‘ Python å¿«é€Ÿå¼€å‘
- æ²¡æœ‰ä¸­æ–­/æŠ¢å è°ƒåº¦/ç³»ç»Ÿè´Ÿè½½å‹åŠ›
- ä¸ç†Ÿæ‚‰ RTOSï¼Œç§»æ¤æˆæœ¬è¿‡é«˜

------

## ğŸ“Œ ç»“è®ºæ€»ç»“ï¼š

| åœºæ™¯                                              | å»ºè®®                                        |
| ------------------------------------------------- | ------------------------------------------- |
| å¿«é€ŸåŸå‹éªŒè¯ã€è¾¹ç¼˜AIã€æ•™è‚²é¡¹ç›®                    | ç›´æ¥ç”¨ MicroPython `_thread` å³å¯           |
| æ§åˆ¶ç®€å•å¤–è®¾ï¼ˆå¦‚ LEDã€èˆµæœºã€ä¸²å£ï¼‰                | MicroPython è¶³å¤Ÿ                            |
| å®æ—¶æ€§è¦æ±‚é«˜ã€ä»»åŠ¡å¤šã€é€»è¾‘å¤æ‚                    | ç§»æ¤ RT-Thread                              |
| æƒ³æ„å»ºå®Œæ•´åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¸¦æ˜¾ç¤º/UIã€é€šä¿¡ã€æ–‡ä»¶ç³»ç»Ÿï¼‰ | å¼ºçƒˆå»ºè®® RT-Thread                          |
| æƒ³ç”¨ MicroPython åˆæƒ³è¦ RTOS è°ƒåº¦åŠŸèƒ½             | ç”¨ RT-Thread + Micropython ç»„ä»¶ï¼ˆå®˜æ–¹å·²æœ‰ï¼‰ |



------

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜å¯ä»¥æä¾›ï¼š

- âœ… K210 ä¸Šç§»æ¤ RT-Thread çš„æ­¥éª¤
- âœ… RT-Thread ä¸­åµŒå…¥ MicroPython çš„æ¨¡æ¿å·¥ç¨‹
- âœ… å¯¹æ¯” RT-Thread çº¿ç¨‹å’Œ `_thread` çš„è¿è¡Œæ•ˆæœ
- âœ… MaixPy ä¸­ `_thread` åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼ˆfreertos-liteï¼‰

æ˜¯å¦éœ€è¦æˆ‘ç»§ç»­å±•å¼€ï¼Ÿä½ ç°åœ¨ä¸»è¦ç›®æ ‡æ˜¯ AI åº”ç”¨ï¼Ÿæ§åˆ¶ç³»ç»Ÿï¼Ÿè¿˜æ˜¯å›¾åƒé‡‡é›†/æ¨ç†è¿™ç±»ä»»åŠ¡ï¼Ÿ





##### You said:

æ€ä¹ˆç§»æ¤RTTåˆ°K210ä¸Š



###### ChatGPT said:

åœ¨ K210 ä¸Šç§»æ¤ RT-Thread ç³»ç»Ÿï¼Œæ¨èä½¿ç”¨ RT-Thread å®˜æ–¹æ”¯æŒçš„ **RT-Thread BSPï¼ˆBoard Support Packageï¼‰** å’Œå·¥å…·é“¾ï¼Œæ­¥éª¤æ¸…æ™°ï¼Œå¹¶ä¸”å·²ç»æ”¯æŒå¸¸è§ K210 å¼€å‘æ¿ï¼ˆå¦‚ Sipeed Maix Dockã€Maix Bitã€Maix Goï¼‰ã€‚

------

## âœ… ä¸€å¥è¯æ€»ç»“ï¼š

> RT-Thread å·²ç»ä¸º K210 æä¾›äº†å®˜æ–¹ BSPï¼Œä½ åªéœ€è¦ç”¨ `RT-Thread Studio` æˆ– `Env å·¥å…· + SCons` å°±èƒ½å¿«é€Ÿæ„å»ºå¹¶çƒ§å½•ç³»ç»Ÿã€‚

------

## ğŸ§± å¼€å‘ç¯å¢ƒå‡†å¤‡

### âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ RT-Thread Studioï¼ˆæ¨è GUI ç”¨æˆ·ï¼‰

1. ä¸‹è½½ RT-Thread Studioï¼ˆè·¨å¹³å° IDEï¼‰
2. å®‰è£…æ—¶å‹¾é€‰ï¼š
   - K210 GCC å·¥å…·é“¾
   - SDK æ”¯æŒåŒ…
3. å¯åŠ¨ Studioï¼Œç‚¹å‡»ï¼š`æ–‡ä»¶ > æ–°å»ºé¡¹ç›® > RT-Thread é¡¹ç›®`
4. é€‰æ‹©å¼€å‘æ¿ï¼š**`sipeed/k210`**
5. ç­‰å¾…åŠ è½½å®Œæˆï¼Œå³å¯çœ‹åˆ°å®Œæ•´ BSP å·¥ç¨‹

------

### âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ `Env` å‘½ä»¤è¡Œå·¥å…·ï¼ˆæ¨èè¿›é˜¶ç”¨æˆ·ï¼‰

#### 1. å®‰è£… Python ç¯å¢ƒï¼ˆ3.6+ï¼‰

```
bashCopy codesudo apt install python3 python3-pip
pip3 install scons pyserial
```

#### 2. ä¸‹è½½ RT-Thread æºç ï¼š

```
bashCopy codegit clone https://github.com/RT-Thread/rt-thread.git
cd rt-thread/bsp/k210
```

#### 3. å®‰è£… Env å·¥å…·ï¼ˆRT-Thread å®˜æ–¹æ„å»ºå·¥å…·ï¼‰

```
bashCopy codegit clone https://github.com/RT-Thread/env.git ~/env
echo 'export RTT_EXEC_PATH=~/.rtt-gcc/riscv64-unknown-elf-gcc/bin' >> ~/.bashrc
echo 'export PATH=~/env:$PATH' >> ~/.bashrc
source ~/.bashrc
```

æˆ–è€…ç›´æ¥æ‰§è¡Œï¼ˆä»…å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰ï¼š

```
bashCopy codeexport RTT_EXEC_PATH=/your/toolchain/path
export PATH=~/env:$PATH
```

#### 4. ä½¿ç”¨ `menuconfig` é…ç½®é¡¹ç›®

```
bashCopy codecd rt-thread/bsp/k210
scons --menuconfig
```

é…ç½®å¸¸è§é€‰é¡¹ï¼š

- å†…æ ¸åŠŸèƒ½ï¼ˆçº¿ç¨‹ã€ä¿¡å·é‡ã€å®šæ—¶å™¨ç­‰ï¼‰
- æ˜¯å¦å¼€å¯ä¸²å£æ§åˆ¶å°
- æ˜¯å¦æ·»åŠ  MicroPython æ”¯æŒ
- é©±åŠ¨æ”¯æŒï¼ˆGPIOã€SPIã€LCDã€CAMã€KPU ç­‰ï¼‰

#### 5. æ„å»ºå·¥ç¨‹

```
bash


Copy code
scons
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä¼šç”Ÿæˆ `rtthread.bin`

------

## ğŸ”¥ çƒ§å½•åˆ° K210

ä½¿ç”¨ `kflash`ï¼ˆå®˜æ–¹æ¨èå·¥å…·ï¼‰ï¼š

### 1. å®‰è£… `kflash.py`ï¼š

```
bash


Copy code
pip3 install kflash
```

### 2. çƒ§å½•ç¨‹åºï¼š

```
bash


Copy code
kflash -p /dev/ttyUSB0 -b 1500000 -t rtthread.bin
```

- `-p`: ä½ çš„ä¸²å£è®¾å¤‡ï¼ˆWindows æ˜¯ COMxï¼ŒLinux æ˜¯ /dev/ttyUSBxï¼‰
- `-t`: çƒ§å½•åè¿æ¥ä¸²å£ç»ˆç«¯
- `-b`: æ³¢ç‰¹ç‡ï¼Œå¯é€‰ 115200 / 1500000

------

## âœ… MicroPython + RTT ä¸€èµ·ç”¨ï¼Ÿ

RT-Thread å®˜æ–¹æ”¯æŒå°† MicroPython **ä½œä¸ºç»„ä»¶åµŒå…¥ RT-Thread ç³»ç»Ÿ**ä¸­ï¼š

1. åœ¨ `menuconfig` ä¸­å¯ç”¨ï¼š

   ```
   rustCopy code-> RT-Thread Components
      -> Micropython: Enable
   ```

2. é‡æ–°ç¼–è¯‘åçƒ§å½•ï¼Œä¼šæœ‰ `/micropython` å‘½ä»¤è¿›å…¥äº¤äº’æ¨¡å¼ã€‚

3. å¯ä»¥åœ¨ RTT Shell ä¸­è¿è¡Œ Python è„šæœ¬ï¼ˆæ”¯æŒå¤šä»»åŠ¡ã€å®šæ—¶å™¨ã€GPIO ç­‰ï¼‰

------

## ğŸ’¡ ç§»æ¤å»ºè®®

- æ¨èç”¨ `RT-Thread Studio` å¿«é€Ÿå…¥é—¨ï¼ˆè‡ªåŠ¨é…ç½® BSP + ç¼–è¯‘ç¯å¢ƒï¼‰
- å¦‚æœä½ æƒ³åšå®šåˆ¶è£å‰ªæˆ–åµŒå…¥ Python è§£é‡Šå™¨ï¼Œå»ºè®®ç”¨ `Env + SCons` å‘½ä»¤è¡Œæ–¹å¼
- å¯¹å›¾åƒå¤„ç†ã€KPU åŠ é€Ÿã€LCD é©±åŠ¨ç­‰ï¼Œå¯ä»¥ç»“åˆ Sipeed æä¾›çš„ [MaixPy SDK æˆ– maix-kflash](https://github.com/sipeed)

------

## ğŸ“¦ å¼€æºå‚è€ƒé¡¹ç›®

- https://github.com/RT-Thread/rt-thread/tree/master/bsp/k210
- https://github.com/RT-Thread/rt-thread/tree/master/components/micropython
- https://github.com/sipeed





# ç§»æ¤è¿‡ç¨‹

https://blog.csdn.net/m0_37570531/article/details/105280876 å‚è€ƒ

## 1. äº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸‹è½½

https://github.com/ilg-archived/riscv-none-gcc/releases/v8.2.0-2.2-20190521

## 2. ä¸‹è½½RTTæºç 

https://github.com/RT-Thread/rt-thread  ï¼ˆè¿™ä¸ªæ˜¯æ ‡å‡†ç‰ˆï¼‰

##  3. sconsç¼–è¯‘é…ç½®

é¦–å…ˆé…ç½®K210BSPçš„è·¯å¾„

é¦–å…ˆé…ç½®sconsç¼–è¯‘æ—¶ç”¨çš„å·¥å…·é“¾è·¯å¾„ã€‚åœ¨ä¸‹è½½å¥½çš„rttæºç ä¸‹æ‰¾åˆ°k210çš„bspï¼Œè·¯å¾„å¦‚ä¸‹ï¼š\rt-thread\bsp\k210ï¼Œæ‰“å¼€æ–‡ä»¶å¤¹ä¸­çš„rtconfig.py

```
éœ€è¦ä¿®æ”¹2ä¸ªåœ°æ–¹ï¼šä¸€æ˜¯EXEC_PATHï¼Œæ”¹ä¸ºç¬¬ä¸€æ­¥ä¸­å·¥å…·é“¾çš„è·¯å¾„ï¼›äºŒæ˜¯æœ€åä¸¤è¡Œä»£ç ç”¨#æ³¨é‡Šæ‰ï¼Œé˜²æ­¢ä¸envä¸­é»˜è®¤æŒ‡å‘å†…éƒ¨çš„arm-gccå·¥å…·é“¾çš„è·¯å¾„å†²çªã€‚
```



##  4. æ‰“å¼€VScode

åœ¨RTTæºç ä¸‹/rt-thread/bsp/k210è·¯å¾„æ‰“å¼€ç»ˆç«¯ï¼Œå¼€å¯é…ç½®ç•Œé¢

```c
sudo apt install scons
```

```c
scons --menuconfig
```

ä½¿ç”¨è¯¥å‘½ä»¤ä¼šå®‰è£…åŠåˆå§‹åŒ–ENVå·¥å…·ï¼Œå¹¶åœ¨Homeä¸‹ç”Ÿæˆâ€œ.envâ€æ–‡ä»¶åŠï¼Œæ­¤æ–‡ä»¶å¤¹ä¸ºéšè—æ–‡ä»¶å‘€ï¼Œåˆ‡æ¢åˆ°homeç›®å½•ï¼Œä½¿ç”¨laå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ã€‚

```c
la ~/.env
$ source ~/.env/env.sh

```



```c
source ~/.env/env.sh
```

è¿è¡Œenv.sh é…ç½®ç¯å¢ƒå˜é‡

```c

cd /mnt/old_system/home/jkx/findwork-jin/K210_car/rt-thread/bsp/k210/

pkgs --update
```

RT-Thread çš„ BSP æ ¹ç›®å½•æ˜¯åŒ…å« `SConstruct`ã€`Kconfig`ã€`board/` ç­‰æ–‡ä»¶çš„é‚£ä¸€å±‚ç›®å½•ï¼Œä½ éœ€è¦åˆ‡æ¢è¿›å»å†æ‰§è¡Œå‘½ä»¤ã€‚ 

ä½¿ç”¨pkgs --update å‘½ä»¤ä¸‹è½½è½¯ä»¶åŒ…åˆ°bspç›®å½•ä¸‹çš„packagesæ–‡ä»¶å¤¹é‡Œ

```c
code .
```

ç„¶åè¾“å…¥å‘½ä»¤code .ï¼ˆä¸è¦æ¼æ‰åé¢çš„ç©ºæ ¼å’Œç‚¹ï¼‰ï¼Œå¬å”¤VSCode

```c
scons --target=vsc -s
```

ç°åœ¨VSCodeä¸­çš„ç»ˆç«¯å°±å˜æˆäº†envå·¥å…·ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç»ˆç«¯ä¸­è¿›è¡Œenvçš„ä¸€äº›æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬è¦å…ˆè¾“å…¥æŒ‡ä»¤ï¼Œscons --target=vsc -sï¼Œå¦‚ä¸‹å›¾

<img src="C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250708170304949.png" alt="image-20250708170304949" style="zoom:150%;" />

è¿™æ¡æŒ‡ä»¤èƒ½å°†åœ¨envä¸­é…ç½®äº§ç”Ÿçš„å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„æ·»åŠ åˆ°vs codeä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨å®Œenvä¸­çš„menuconfigåŠŸèƒ½åéƒ½è¦è®°å¾—ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æ›´æ–°ä¸€ä¸‹é…ç½®ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°å¤´æ–‡ä»¶çš„é”™è¯¯ã€‚

## 5.ç¼–è¯‘å’Œä¸‹è½½

åœ¨vs codeçš„ç»ˆç«¯ä¸­è¾“å…¥â€œsconsâ€å¹¶æŒ‰å›è½¦ï¼Œç­‰å¾…ä¸€ä¼šå„¿è¦æ˜¯æ²¡æœ‰errorï¼Œæ˜¾ç¤ºscons: done building targets.å°±æˆåŠŸå®Œæˆç¼–è¯‘äº†ï¼Œå·¥ç¨‹æ–‡ä»¶å¤¹ä¸­å°±ä¼šå¤šå‡ºä¸€ä¸ªbinæ–‡ä»¶

```c
scons

```

![image-20250708170450219](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250708170450219.png)

ä¸‹è½½kflash.py 

https://github.com/kendryte/kflash.py

è§£å‹-ã€‹æ’å…¥K210åˆ°ç”µè„‘ä¸Šä¸Šç”µ

åœ¨KLflash.py  masteræ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ç»ˆç«¯  ä¸‹è½½binæ–‡ä»¶

![image-20250708171219466](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250708171219466.png)

```c
sudo python3 kflash.py -t ../rt-thread/bsp/k210/rtthread.bin
```

æˆ‘æ²¡æœ‰K210æ²¡å·®ç‚¹ æ‰€ä»¥æŠ¥é”™  æ²¡è¯†åˆ«å‡º

![image-20250708171338524](C:\Users\jkx-pig\AppData\Roaming\Typora\typora-user-images\image-20250708171338524.png)

ç­‰å¾…çƒ§å½•å®Œæˆåï¼Œç†Ÿæ‚‰çš„RTTç•Œé¢å°±å‡ºç°äº†ã€‚



VSCODE  UBUNTU K210 RTT





åœ¨RT-Threadï¼ˆRTTï¼‰ä¸MicroPythonï¼ˆå¦‚CanMVï¼‰ä¸­å¼€å‘K210å­˜åœ¨æ ¹æœ¬æ€§çš„æ¶æ„å·®å¼‚ï¼Œä»¥ä¸‹æ˜¯å…³é”®åŒºåˆ«å’ŒRTTå¼€å‘æ–¹å¼çš„è¯¦è§£ï¼š

------

### **1. æ¶æ„å·®å¼‚å¯¹æ¯”**

| **æ–¹é¢**         | **MicroPython/CanMV**            | **RT-Thread (Cè¯­è¨€)**                      |
| :--------------- | :------------------------------- | :----------------------------------------- |
| **ç¡¬ä»¶æŠ½è±¡å±‚**   | é€šè¿‡`fpioa_manager`åŠ¨æ€æ³¨å†Œå¼•è„š  | åœ¨`board.h`ä¸­é™æ€å®šä¹‰å¼•è„šæ˜ å°„              |
| **é©±åŠ¨è°ƒç”¨æ–¹å¼** | ç›´æ¥æ“ä½œç¡¬ä»¶å¯¹è±¡ï¼ˆå¦‚`GPIO(35)`ï¼‰ | é€šè¿‡è®¾å¤‡æ¡†æ¶ï¼ˆå¦‚`rt_device_find("pwm0")`ï¼‰ |
| **åˆå§‹åŒ–æ—¶æœº**   | è¿è¡Œæ—¶åŠ¨æ€åˆå§‹åŒ–                 | ç³»ç»Ÿå¯åŠ¨æ—¶é™æ€åˆå§‹åŒ–                       |
| **å¼•è„šç®¡ç†**     | éœ€æ‰‹åŠ¨è°ƒç”¨`fm.register()`        | BSPå·²é¢„å…ˆé…ç½®å¥½å¤–è®¾å¼•è„š                    |

------

### **2. RT-Threadå¼•è„šæ˜ å°„åœ¨å“ªé‡Œï¼Ÿ**

åœ¨RTTçš„BSPä¸­ï¼Œæ‰€æœ‰ç¡¬ä»¶æ˜ å°„é›†ä¸­åœ¨ **`board.h`** å’Œ **`board.c`** ä¸­ï¼š

#### **(1) ç¤ºä¾‹ï¼šK210çš„PWMå¼•è„šå®šä¹‰**

c



Copy



Download

```
// bsp/k210/board.h
#define BSP_PWM0_PIN    8   // PWM0é»˜è®¤ç»‘å®šåˆ°GPIO8
#define BSP_I2C0_SCL_PIN 24 // I2C0æ—¶é’Ÿçº¿
#define BSP_I2C0_SDA_PIN 25 // I2C0æ•°æ®çº¿
```

#### **(2) ä¿®æ”¹å¼•è„šçš„æ–¹æ³•**

è‹¥éœ€æ›´æ”¹PWMå¼•è„šï¼š

c



Copy



Download

```
// åœ¨board.cä¸­é‡å†™åˆå§‹åŒ–ä»£ç 
rt_err_t rt_hw_pwm_init(void) {
    /* å°†PWM0é‡æ˜ å°„åˆ°GPIO12 */
    fpioa_set_function(12, FUNC_TIMER0_TOGGLE1);
    return RT_EOK;
}
```

------

### **3. ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°å¼•è„šæ“ä½œä»£ç ï¼Ÿ**

RTTé€šè¿‡ **è®¾å¤‡é©±åŠ¨æ¡†æ¶** å®ç°äº†ç¡¬ä»¶æ“ä½œçš„å°è£…ï¼š

#### **(1) GPIOæ“ä½œå¯¹æ¯”**

python



Copy



Download

```
# MicroPython
from machine import GPIO
led = GPIO(35, GPIO.OUT)
led.value(0)
```

c



Copy



Download

```
// RT-Thread
#include <rtdevice.h>
rt_device_t led = rt_device_find("gpio0");
rt_device_open(led, RT_DEVICE_FLAG_RDWR);
rt_device_write(led, 0, RT_NULL, 0);  // è¾“å‡ºä½ç”µå¹³
```



